# 架构真经：互联网技术架构的设计原则

## 主旨

这本书的英文名是scalability rules，但这里的scalability比狭义的可扩展性含义更广泛，不止是架构上，也涉及到工程、团队等方面的经验总结。

## 50条可扩展性规则

* 规则1 避免过度设计

产品的设计超出设计需求、完成的产品对于用户过度复杂、技术实现复杂到令他人难以理解都是过度设计的表现。复杂的系统实施成本高、维护困难，简单的系统容易扩展、可维护性强且成本低。

* 规则2 方案中包括扩展

在早期考虑到容量扩展的需求，但借助IaaS等服务可以在容量临近所需时再按需扩展。

* 规则3 三次简化方案

从方案的范围、设计和实施角度进行简化。

* 规则4 减少域名解析

对于性能敏感的网页，减少下载页面所需的域名解析次数。

* 规则5 减少页面目标

对于性能敏感的网页，减少网页上的对象数量和尽可能缩小对象大小。

* 规则6 采用同构网络

对于路由器和交换机，确保使用同一供应商的产品，可以减少可用性和可扩展性方面的问题。

![AKF立方体](images/AKF.png)

* 规则7 X轴扩展

AKF立方体中的X轴扩展，即水平扩展。通过复制服务或者数据库以分散事务负载。研发成本低，适用于业务发展初期，业务复杂度低，需要增加系统容量的场景。

* 规则8 Y轴拆分

AKF立方体中的Y轴扩展，将服务和数据按照动词/名词定义的边界进行拆分。研发成本中，适用于业务逐渐复杂，数据量逐渐增大，代码耦合度变高，团队规模较大时的场景。

* 规则9 Z轴拆分

AKF立方体中的Z轴扩展，即分片。将数据或者服务按照用户属性进行拆分。研发成本高，适用于用户数量按指数级快速增长的场景。

* 规则10 向外扩展

向外扩展（Scale Out）而不是向上扩展（Scale Up），使技术资源投入的成本随着业务复杂度而线性增加。

* 规则11 用商品化系统

商品化系统是指成本低廉的小型机而不是规格巨大的大型机。单机规格越大，性价比就越低，投资成本越大。廉价的小型机意味着可随时被替换，并适合将来业务高速扩张时进行扩展。

* 规则12 托管方案扩展

使用多活数据中心来降低数据中心的总体成本、增强可用性和实现异地灾备。N（N≥3）个数据中心的解决方案与两数据中心相比总体成本更低。只要保证N-1个数据中心的可用性，就可保证数据和功能不受影响。

* 规则13 利用云

利用云的弹性和敏捷性应对临时需求，可实现在短时间内按需扩展。

* 规则14 适当使用数据库

考虑数据量、数据关系、一致性、灵活性、可扩展性等因素，在关系型数据库、NoSQL、文件系统之间进行取舍。

* 规则15 慎重使用防火墙
* 规则16 积极使用日志文件
* 规则17 避免画蛇添足
* 规则18 停止重定向
* 规则19 放宽时间约束
* 规则20 利用CDN缓存
* 规则21 灵活管理缓存
* 规则22 利用Ajax缓存
* 规则23 利用页面缓存
* 规则24 利用应用缓存
* 规则25 利用对象缓存
* 规则26 独立对象缓存
* 规则27 失败乃成功之母
* 规则28 不靠QA发现错误
* 规则29 不能回滚注定失败
* 规则30 从事务处理中清除商务智能
* 规则31 注意昂贵的关系
* 规则32 正确使用数据库锁
* 规则33 禁用分阶段提交
* 规则34 慎用Select for Update
* 规则35 避免选择所有列
* 规则36 用“泳道”隔离故障
* 规则37 拒绝单点故障
* 规则38 避免系统串联
* 规则39 启用与禁用功能
* 规则40 力求无状态
* 规则41 在浏览器中保存会话数据
* 规则42 用分布式缓存处理状态
* 规则43 尽可能异步通信
* 规则44 扩展消息总线
* 规则45 避免总线过度拥挤
* 规则46 警惕第三方方案
* 规则47 梯级存储策略
* 规则48 分类处理不同负载
* 规则49 完善监控
* 规则50 保持竞争力

